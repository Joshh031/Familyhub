<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FamilyHub ‚Äî Josh & Jess</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0a0a0f;
  --surface:#111118;
  --surface2:#18181f;
  --surface3:#1e1e28;
  --border:#ffffff0f;
  --border2:#ffffff18;
  --text:#f0f0ff;
  --muted:#6b7280;
  --muted2:#9ca3af;
  --blue:#3b82f6;
  --blue-bright:#60a5fa;
  --blue-dim:#1e3a5f;
  --blue-glow:rgba(59,130,246,0.15);
  --blue-glow2:rgba(59,130,246,0.08);
  --green:#10b981;
  --red:#ef4444;
  --amber:#f59e0b;
  --r:6px;--rm:10px;--rl:14px;--rxl:18px;
  -webkit-font-smoothing:antialiased;
}
body{font-family:'Inter',-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:14px}

/* NAV TABS */
.app-nav{background:var(--surface);border-bottom:1px solid var(--border2);display:flex;align-items:center;padding:0 20px;height:52px;gap:4px;position:sticky;top:0;z-index:100}
.nav-logo{display:flex;align-items:center;gap:8px;font-weight:700;font-size:15px;letter-spacing:-.4px;margin-right:16px;color:var(--text)}
.nav-logo-mark{width:28px;height:28px;background:var(--blue);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px;box-shadow:0 0 12px var(--blue-glow)}
.nav-tab{padding:6px 14px;border-radius:var(--r);border:none;background:transparent;font-family:'Inter',sans-serif;font-size:13px;font-weight:500;color:var(--muted);cursor:pointer;transition:all .15s;white-space:nowrap}
.nav-tab:hover{color:var(--text);background:var(--surface2)}
.nav-tab.active{color:var(--blue-bright);background:var(--blue-glow)}
.nav-right{margin-left:auto;display:flex;align-items:center;gap:8px}
.live-pill{display:flex;align-items:center;gap:5px;border:1px solid var(--border2);border-radius:20px;padding:4px 10px;font-size:11px;font-weight:500;color:var(--muted2)}
.live-dot{width:6px;height:6px;background:var(--green);border-radius:50%;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(16,185,129,.4)}50%{opacity:.7;box-shadow:0 0 0 4px rgba(16,185,129,0)}}

/* PAGES */
.page{display:none}.page.active{display:block}

/* ‚îÄ‚îÄ CALENDAR PAGE ‚îÄ‚îÄ */
.cal-shell{display:grid;grid-template-columns:220px 1fr;height:calc(100vh - 52px);overflow:hidden}
.sidebar{background:var(--surface);border-right:1px solid var(--border2);overflow-y:auto;padding:16px 0}
.sidebar::-webkit-scrollbar{width:3px}.sidebar::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
.sb-sec{padding:0 12px 14px}
.sb-label{font-size:10px;font-weight:600;letter-spacing:.7px;text-transform:uppercase;color:var(--muted);padding:0 6px;margin-bottom:6px}
.sb-div{height:1px;background:var(--border);margin:0 12px 14px}

/* mini cal */
.mc{padding:0 12px 14px}
.mc-hd{display:flex;align-items:center;justify-content:space-between;padding:0 4px;margin-bottom:8px}
.mc-title{font-size:12px;font-weight:600;color:var(--text)}
.mc-nav{width:22px;height:22px;background:none;border:none;color:var(--muted);cursor:pointer;border-radius:4px;font-size:14px;display:flex;align-items:center;justify-content:center}
.mc-nav:hover{background:var(--surface2);color:var(--text)}
.mc-grid{display:grid;grid-template-columns:repeat(7,1fr);text-align:center}
.mc-dow{font-size:9px;font-weight:600;color:var(--muted);text-transform:uppercase;padding:3px 0 5px}
.mc-d{font-size:11px;color:var(--muted2);padding:4px 1px;border-radius:4px;cursor:pointer;position:relative;transition:background .1s}
.mc-d:hover{background:var(--surface2)}
.mc-d.tod{font-weight:700;color:var(--blue-bright)}
.mc-d.tod::after{content:'';position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:3px;height:3px;border-radius:50%;background:var(--blue)}
.mc-d.oth{color:var(--border2)}
.mc-d.dot::before{content:'';position:absolute;bottom:1px;left:50%;transform:translateX(-50%);width:3px;height:3px;border-radius:50%;background:var(--blue-dim)}

/* cats */
.cat{display:flex;align-items:center;gap:8px;padding:5px 6px;border-radius:var(--r);cursor:pointer;transition:background .1s;font-size:12px;color:var(--text);user-select:none}
.cat:hover{background:var(--surface2)}
.cat.off{opacity:.28}
.cat-dot{width:7px;height:7px;border-radius:2px;flex-shrink:0}
.cat-em{font-size:13px;width:18px;text-align:center;flex-shrink:0}
.cat-n{flex:1}
.cat-c{font-size:10px;font-family:'JetBrains Mono',monospace;color:var(--muted)}

/* upcoming */
.up-item{padding:6px 6px;border-radius:var(--r);margin-bottom:2px;cursor:pointer;transition:background .1s;display:flex;align-items:flex-start;gap:8px}
.up-item:hover{background:var(--surface2)}
.up-bar{width:2px;border-radius:2px;flex-shrink:0;margin-top:3px;align-self:stretch;min-height:24px}
.up-name{font-size:11px;font-weight:500;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.up-meta{font-size:10px;color:var(--muted);margin-top:1px}

/* main cal */
.cal-main{overflow-y:auto;background:var(--bg)}
.cal-main::-webkit-scrollbar{width:5px}.cal-main::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:3px}
.cal-topbar{display:flex;align-items:center;justify-content:space-between;padding:16px 20px 12px;position:sticky;top:0;background:var(--bg);z-index:10;border-bottom:1px solid var(--border)}
.cal-nav-area{display:flex;align-items:center;gap:6px}
.month-lbl{font-size:18px;font-weight:700;letter-spacing:-.5px;color:var(--text);padding:0 6px;min-width:160px}
.ib{width:30px;height:30px;border-radius:var(--r);border:1px solid var(--border2);background:var(--surface);color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .12s}
.ib:hover{background:var(--surface2);border-color:var(--blue-dim);color:var(--text)}
.cal-topbar-right{display:flex;align-items:center;gap:8px}
.seg{display:flex;background:var(--surface2);border-radius:var(--r);padding:2px;gap:1px;border:1px solid var(--border)}
.seg-b{padding:4px 12px;border-radius:5px;border:none;background:transparent;font-family:'Inter',sans-serif;font-size:12px;font-weight:500;color:var(--muted);cursor:pointer;transition:all .12s}
.seg-b.on{background:var(--blue-dim);color:var(--blue-bright)}
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 14px;border-radius:var(--r);border:none;cursor:pointer;font-family:'Inter',sans-serif;font-size:13px;font-weight:500;transition:all .12s;white-space:nowrap}
.btn-ghost{background:var(--surface2);color:var(--muted2);border:1px solid var(--border2)}
.btn-ghost:hover{background:var(--surface3);color:var(--text);border-color:var(--border2)}
.btn-blue{background:var(--blue);color:#fff;box-shadow:0 0 16px var(--blue-glow)}
.btn-blue:hover{background:#2563eb}
.btn-today{background:var(--surface2);color:var(--muted2);border:1px solid var(--border);font-size:12px;padding:5px 12px}
.btn-today:hover{color:var(--text);border-color:var(--blue-dim)}

/* calendar grid */
.cg-wrap{padding:16px 20px 24px}
.cg{border:1px solid var(--border2);border-radius:var(--rl);overflow:hidden}
.chr{display:grid;grid-template-columns:repeat(7,1fr);background:var(--surface2);border-bottom:1px solid var(--border)}
.chc{padding:10px 10px;font-size:10px;font-weight:600;letter-spacing:.5px;text-transform:uppercase;color:var(--muted)}
.cb{display:grid;grid-template-columns:repeat(7,1fr)}
.cell{min-height:108px;padding:8px 8px 5px;border-right:1px solid var(--border);border-bottom:1px solid var(--border);cursor:pointer;transition:background .1s;position:relative;overflow:hidden;background:var(--surface)}
.cell:nth-child(7n){border-right:none}
.cell:hover{background:var(--surface2)}
.cell.out{background:var(--bg)}
.cell.out .dn{color:var(--border2)}
.cell.tod{background:var(--blue-glow2)}
.cell.tod .dnw{background:var(--blue);border-radius:5px;width:22px;height:22px;display:flex;align-items:center;justify-content:center}
.cell.tod .dn{color:#fff;font-weight:700}
.cell.brk{background:rgba(124,58,237,.05)}
.ct{display:flex;align-items:center;margin-bottom:5px}
.dn{font-size:12px;font-weight:500;color:var(--muted2);line-height:1}
.dnw{display:inline-flex}
.ces{display:flex;flex-direction:column;gap:2px}
.ev{display:flex;align-items:center;gap:3px;padding:2px 5px;border-radius:3px;font-size:10px;font-weight:500;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:filter .1s,transform .1s;line-height:1.55;max-width:100%}
.ev:hover{filter:brightness(1.15);transform:translateX(1px)}
.ev-i{font-size:9px;flex-shrink:0}
.ev-l{overflow:hidden;text-overflow:ellipsis}
.ev-m{font-size:10px;color:var(--muted);padding:0 2px;cursor:pointer}
.ev-m:hover{color:var(--blue-bright)}

/* list view */
.lw{padding:16px 20px 32px}
.ld-hd{display:flex;align-items:center;gap:10px;padding:8px 0 6px;position:sticky;top:0;background:var(--bg);z-index:2}
.ld-lbl{font-size:10px;font-weight:700;letter-spacing:.6px;text-transform:uppercase;color:var(--muted)}
.ld-lbl.tl{color:var(--blue-bright)}
.ld-line{flex:1;height:1px;background:var(--border)}
.lc{background:var(--surface);border:1px solid var(--border);border-radius:var(--rm);padding:11px 14px;margin-bottom:4px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:all .12s}
.lc:hover{background:var(--surface2);border-color:var(--border2);transform:translateX(2px)}
.lc-strip{width:3px;align-self:stretch;border-radius:2px;flex-shrink:0;min-height:22px}
.lc-ico{font-size:20px;flex-shrink:0}
.lc-b{flex:1;min-width:0}
.lc-t{font-size:13px;font-weight:600;color:var(--text)}
.lc-s{font-size:11px;color:var(--muted);margin-top:2px}
.tag{font-size:11px;font-weight:500;padding:2px 8px;border-radius:20px;color:var(--muted2);background:var(--surface2);border:1px solid var(--border);white-space:nowrap}

/* ‚îÄ‚îÄ OVERLAYS / MODALS ‚îÄ‚îÄ */
.ov{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(6px);z-index:200;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .18s}
.ov.open{opacity:1;pointer-events:all}
.modal{background:var(--surface);border:1px solid var(--border2);border-radius:var(--rxl);width:500px;max-width:calc(100vw - 24px);max-height:calc(100vh - 48px);overflow-y:auto;box-shadow:0 24px 48px rgba(0,0,0,.6),0 0 0 1px var(--border);transform:translateY(16px) scale(.97);transition:transform .22s cubic-bezier(.34,1.56,.64,1)}
.modal::-webkit-scrollbar{width:4px}.modal::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
.ov.open .modal{transform:translateY(0) scale(1)}
.mhd{padding:18px 22px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--surface);z-index:1;border-radius:var(--rxl) var(--rxl) 0 0}
.mtitle{font-size:16px;font-weight:700;letter-spacing:-.3px;color:var(--text)}
.mclose{width:26px;height:26px;background:var(--surface2);border:1px solid var(--border);border-radius:50%;color:var(--muted);cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;transition:all .1s}
.mclose:hover{background:var(--surface3);color:var(--text)}
.mbd{padding:18px 22px 22px}
.fg{margin-bottom:14px}
.fl{display:block;font-size:11px;font-weight:600;color:var(--muted2);letter-spacing:.3px;margin-bottom:5px;text-transform:uppercase}
.fi{width:100%;background:var(--surface2);border:1px solid var(--border2);border-radius:var(--r);padding:9px 12px;font-family:'Inter',sans-serif;font-size:13px;color:var(--text);outline:none;transition:border-color .15s,box-shadow .15s}
.fi:focus{border-color:var(--blue);box-shadow:0 0 0 3px var(--blue-glow)}
.fi::placeholder{color:var(--muted)}
.fi option{background:var(--surface2)}
textarea.fi{resize:vertical;min-height:66px;line-height:1.5}
.f2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.tg{display:grid;grid-template-columns:repeat(3,1fr);gap:5px}
.tc{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:9px 5px;border-radius:var(--r);border:1px solid var(--border2);background:var(--surface2);cursor:pointer;transition:all .12s;font-family:'Inter',sans-serif;font-size:10px;font-weight:600;color:var(--muted2);text-align:center;letter-spacing:.2px}
.tc:hover{border-color:var(--blue-dim);color:var(--text)}
.tc.on{border-color:var(--blue);background:var(--blue-dim);color:var(--blue-bright)}
.tc-i{font-size:17px}
.wr{display:flex;flex-wrap:wrap;gap:6px}
.wc{padding:5px 12px;border-radius:20px;border:1px solid var(--border2);background:var(--surface2);font-family:'Inter',sans-serif;font-size:12px;font-weight:500;color:var(--muted2);cursor:pointer;transition:all .12s}
.wc:hover{border-color:var(--blue-dim);color:var(--text)}
.wc.on{background:var(--blue-dim);border-color:var(--blue);color:var(--blue-bright)}
.mft{display:flex;gap:8px;justify-content:flex-end;padding-top:14px;border-top:1px solid var(--border);margin-top:18px}
.btn-del{color:#fca5a5;background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.25)}
.btn-del:hover{background:rgba(239,68,68,.2)}
.dbadge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:20px;font-size:12px;font-weight:600;margin-bottom:16px}
.dr{display:flex;gap:12px;align-items:flex-start;margin-bottom:10px;font-size:13px}
.di{font-size:15px;flex-shrink:0;margin-top:1px}
.dl{font-size:11px;color:var(--muted);font-weight:500;min-width:58px;margin-top:2px}
.dv{color:var(--text)}

/* ‚îÄ‚îÄ BIRTHDAY BOOK PAGE ‚îÄ‚îÄ */
.page-wrap{max-width:900px;margin:0 auto;padding:28px 24px 48px}
.page-header{margin-bottom:24px}
.page-title{font-size:24px;font-weight:800;letter-spacing:-.6px;color:var(--text);margin-bottom:4px}
.page-sub{font-size:13px;color:var(--muted)}
.section-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;margin-top:24px}
.section-title{font-size:13px;font-weight:700;letter-spacing:-.2px;color:var(--text);display:flex;align-items:center;gap:8px}
.section-title .sec-icon{font-size:16px}

/* Birthday cards */
.bday-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
.bday-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--rm);padding:14px;display:flex;align-items:center;gap:12px;transition:all .12s;cursor:default}
.bday-card:hover{border-color:var(--border2);background:var(--surface2)}
.bday-avatar{width:38px;height:38px;border-radius:50%;background:var(--blue-dim);border:2px solid var(--blue-dim);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.bday-info{flex:1;min-width:0}
.bday-name{font-size:13px;font-weight:600;color:var(--text)}
.bday-date{font-size:11px;color:var(--muted);margin-top:2px}
.bday-soon{font-size:10px;font-weight:600;color:var(--blue-bright);margin-top:2px}
.bday-actions{display:flex;gap:4px}
.icon-btn-sm{width:26px;height:26px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--r);color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:11px;transition:all .1s}
.icon-btn-sm:hover{background:var(--surface3);color:var(--text)}

/* Party tracker */
.party-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--rm);padding:14px 16px;margin-bottom:8px;display:flex;align-items:center;gap:14px;transition:all .12s}
.party-card:hover{border-color:var(--border2);background:var(--surface2)}
.party-ico{font-size:24px;flex-shrink:0}
.party-info{flex:1;min-width:0}
.party-name{font-size:13px;font-weight:600;color:var(--text)}
.party-meta{font-size:11px;color:var(--muted);margin-top:2px}
.gift-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600;cursor:pointer;transition:all .15s;border:1px solid transparent;white-space:nowrap}
.gift-need{background:rgba(245,158,11,.12);color:var(--amber);border-color:rgba(245,158,11,.25)}
.gift-need:hover{background:rgba(245,158,11,.2)}
.gift-bought{background:rgba(16,185,129,.12);color:var(--green);border-color:rgba(16,185,129,.25)}
.gift-bought:hover{background:rgba(16,185,129,.2)}
.gift-wrapped{background:rgba(59,130,246,.12);color:var(--blue-bright);border-color:rgba(59,130,246,.25)}

/* ‚îÄ‚îÄ SHOPPING LIST PAGE ‚îÄ‚îÄ */
.shop-wrap{max-width:680px;margin:0 auto;padding:28px 24px 64px}
.shop-input-row{display:flex;gap:8px;margin-bottom:20px}
.shop-input{flex:1;background:var(--surface2);border:1px solid var(--border2);border-radius:var(--rm);padding:12px 16px;font-family:'Inter',sans-serif;font-size:14px;color:var(--text);outline:none;transition:border-color .15s,box-shadow .15s}
.shop-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px var(--blue-glow)}
.shop-input::placeholder{color:var(--muted)}
.shop-cat-sel{background:var(--surface2);border:1px solid var(--border2);border-radius:var(--rm);padding:12px 14px;font-family:'Inter',sans-serif;font-size:13px;color:var(--text);outline:none;cursor:pointer;transition:border-color .15s}
.shop-cat-sel:focus{border-color:var(--blue)}
.shop-cat-sel option{background:var(--surface2)}
.shop-section{margin-bottom:20px}
.shop-cat-hd{font-size:10px;font-weight:700;letter-spacing:.7px;text-transform:uppercase;color:var(--muted);padding:6px 0;border-bottom:1px solid var(--border);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.shop-item{display:flex;align-items:center;gap:12px;padding:10px 14px;background:var(--surface);border:1px solid var(--border);border-radius:var(--rm);margin-bottom:6px;transition:all .12s;cursor:pointer}
.shop-item:hover{border-color:var(--border2);background:var(--surface2)}
.shop-item.done{opacity:.4}
.shop-item.done .shop-item-name{text-decoration:line-through;color:var(--muted)}
.shop-cb{width:18px;height:18px;border-radius:5px;border:2px solid var(--border2);background:transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s}
.shop-cb.checked{background:var(--blue);border-color:var(--blue);box-shadow:0 0 8px var(--blue-glow)}
.shop-cb.checked::after{content:'‚úì';font-size:10px;color:#fff;font-weight:700}
.shop-item-name{flex:1;font-size:13px;font-weight:500;color:var(--text)}
.shop-item-qty{font-size:11px;color:var(--muted);background:var(--surface2);border:1px solid var(--border);padding:2px 7px;border-radius:10px}
.shop-del{width:22px;height:22px;background:none;border:none;color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;border-radius:4px;transition:all .1s;opacity:0}
.shop-item:hover .shop-del{opacity:1}
.shop-del:hover{background:rgba(239,68,68,.15);color:var(--red)}
.shop-stats{display:flex;gap:16px;margin-bottom:20px;padding:14px 16px;background:var(--surface);border:1px solid var(--border);border-radius:var(--rm)}
.shop-stat{text-align:center}
.shop-stat-n{font-size:22px;font-weight:800;color:var(--blue-bright);font-family:'JetBrains Mono',monospace}
.shop-stat-l{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-top:1px}
.clear-done{font-size:12px;color:var(--muted);cursor:pointer;background:none;border:none;font-family:'Inter',sans-serif;margin-left:auto}
.clear-done:hover{color:var(--red)}
.todo-pri-high{border-left-color:#ef4444 !important}
.todo-pri-low{border-left-color:#3b82f6 !important}
.todo-pri-badge{font-size:9px;font-weight:700;letter-spacing:.4px;text-transform:uppercase;padding:2px 6px;border-radius:10px}
.todo-pri-badge.high{background:rgba(239,68,68,.15);color:#f87171}
.todo-pri-badge.low{background:rgba(59,130,246,.15);color:#60a5fa}
.todo-who-badge{font-size:10px;font-weight:600;padding:2px 7px;border-radius:10px;background:var(--surface2);border:1px solid var(--border);color:var(--muted2)}

/* Toast */
.toast-root{position:fixed;bottom:20px;right:20px;z-index:500;display:flex;flex-direction:column;gap:6px;pointer-events:none}
.toast{background:var(--surface2);color:var(--text);border:1px solid var(--border2);border-radius:var(--rm);padding:10px 14px;font-size:13px;font-weight:500;box-shadow:0 8px 24px rgba(0,0,0,.4);display:flex;align-items:center;gap:8px;pointer-events:all;animation:tin .2s cubic-bezier(.34,1.56,.64,1) forwards}
@keyframes tin{from{opacity:0;transform:translateY(10px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}
.toast.out{animation:tout .18s ease forwards}
@keyframes tout{to{opacity:0;transform:translateY(8px)}}

/* settings card */
.sc{background:var(--surface2);border:1px solid var(--border);border-radius:var(--rm);padding:14px 16px;margin-bottom:10px}
.sct{font-size:13px;font-weight:600;color:var(--text);margin-bottom:6px;display:flex;align-items:center;gap:6px}
.scs{font-size:12px;color:var(--muted);margin-bottom:10px}
.sur{display:flex;gap:8px}
.su{flex:1;font-size:12px;font-family:'JetBrains Mono',monospace;background:var(--surface);border:1px solid var(--border2);border-radius:var(--r);padding:7px 10px;color:var(--muted2)}
.ur{display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:13px;color:var(--text)}
.ud{width:7px;height:7px;border-radius:50%;flex-shrink:0}

@media(max-width:780px){.cal-shell{grid-template-columns:1fr}.sidebar{display:none}}
@media(max-width:540px){.cell{min-height:64px;padding:5px 3px}.ev{display:none}}
</style>
</head>
<body>

<!-- TOP NAV -->
<nav class="app-nav">
  <div class="nav-logo"><div class="nav-logo-mark">üè°</div>FamilyHub</div>
  <button class="nav-tab active" onclick="showPage('cal')">üìÖ Calendar</button>
  <button class="nav-tab" onclick="showPage('bdays')">üéÇ Birthdays</button>
  <button class="nav-tab" onclick="showPage('shop')">üõí Shopping</button>
  <button class="nav-tab" onclick="showPage('todo')">‚úÖ To-Do</button>
  <div class="nav-right">
    <div class="live-pill"><div class="live-dot"></div>Live ¬∑ Jess &amp; Josh</div>
    <button class="btn btn-ghost" style="font-size:12px;padding:5px 12px" onclick="openOv('setOv')">‚öô Settings</button>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     CALENDAR PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-cal">
<div class="cal-shell">
  <aside class="sidebar">
    <div class="mc">
      <div class="mc-hd">
        <span class="mc-title" id="miniLbl"></span>
        <div style="display:flex;gap:2px">
          <button class="mc-nav" onclick="miniNav(-1)">‚Äπ</button>
          <button class="mc-nav" onclick="miniNav(1)">‚Ä∫</button>
        </div>
      </div>
      <div class="mc-grid" id="miniGrid"></div>
    </div>
    <div class="sb-div"></div>
    <div class="sb-sec">
      <div class="sb-label">Calendars</div>
      <div id="catList"></div>
    </div>
    <div class="sb-div"></div>
    <div class="sb-sec">
      <div class="sb-label">Upcoming</div>
      <div id="upList"></div>
    </div>
  </aside>

  <div class="cal-main">
    <div class="cal-topbar">
      <div class="cal-nav-area">
        <button class="ib" onclick="navigate(-1)"><svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M9 11L5 7l4-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <span class="month-lbl" id="mainLbl"></span>
        <button class="ib" onclick="navigate(1)"><svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M5 11l4-4-4-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <button class="btn btn-today" onclick="goToday()">Today</button>
      </div>
      <div class="cal-topbar-right">
        <div class="seg">
          <button class="seg-b on" id="vbM" onclick="setView('month')">Month</button>
          <button class="seg-b" id="vbL" onclick="setView('list')">List</button>
        </div>
        <button class="btn btn-blue" onclick="openAdd()">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M6 1v10M1 6h10" stroke="white" stroke-width="1.8" stroke-linecap="round"/></svg>
          Add Event
        </button>
      </div>
    </div>
    <div id="mainContent"></div>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     BIRTHDAY BOOK PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-bdays">
<div class="page-wrap">
  <div class="page-header">
    <div class="page-title">üéÇ Birthday Book</div>
    <div class="page-sub">Recurring family & friend birthdays + upcoming party tracker</div>
  </div>

  <div class="section-hd">
    <div class="section-title"><span class="sec-icon">üîÅ</span>Annual Birthdays</div>
    <button class="btn btn-blue" style="font-size:12px;padding:6px 14px" onclick="openOv('bdayAddOv')">+ Add Birthday</button>
  </div>
  <div class="bday-grid" id="bdayGrid"></div>

  <div class="section-hd" style="margin-top:28px">
    <div class="section-title"><span class="sec-icon">üéÅ</span>Upcoming Kid Parties</div>
    <button class="btn btn-blue" style="font-size:12px;padding:6px 14px" onclick="openOv('partyAddOv')">+ Add Party</button>
  </div>
  <div id="partyList"></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SHOPPING LIST PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-shop">
<div class="shop-wrap">
  <div class="page-header">
    <div class="page-title">üõí Shopping List</div>
    <div class="page-sub">Shared list ‚Äî both of you can add and check off items</div>
  </div>

  <div class="shop-stats">
    <div class="shop-stat"><div class="shop-stat-n" id="statTotal">0</div><div class="shop-stat-l">Total</div></div>
    <div class="shop-stat"><div class="shop-stat-n" id="statLeft">0</div><div class="shop-stat-l">Remaining</div></div>
    <div class="shop-stat"><div class="shop-stat-n" id="statDone">0</div><div class="shop-stat-l">Done</div></div>
    <button class="clear-done" onclick="clearDone()">Clear done √ó</button>
  </div>

  <div class="shop-input-row">
    <input type="text" class="shop-input" id="shopInput" placeholder="Add item‚Ä¶ (press Enter)" onkeydown="if(event.key==='Enter')addShopItem()">
    <select class="shop-cat-sel" id="shopCat">
      <option value="Groceries">ü•¶ Groceries</option>
      <option value="Household">üè† Household</option>
      <option value="Kids">üëß Kids</option>
      <option value="Sports">‚öΩ Sports</option>
      <option value="Pharmacy">üíä Pharmacy</option>
      <option value="Other">üì¶ Other</option>
    </select>
    <input type="text" class="fi" id="shopQty" placeholder="Qty" style="width:70px;background:var(--surface2);border:1px solid var(--border2);border-radius:var(--rm);padding:12px 10px;font-family:Inter,sans-serif;font-size:13px;color:var(--text);outline:none">
    <button class="btn btn-blue" onclick="addShopItem()">Add</button>
  </div>
  <div id="shopLists"></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TO-DO LIST PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-todo">
<div class="shop-wrap">
  <div class="page-header">
    <div class="page-title">‚úÖ To-Do List</div>
    <div class="page-sub">Shared tasks for Josh & Jess ‚Äî check things off as you go</div>
  </div>

  <div class="shop-stats">
    <div class="shop-stat"><div class="shop-stat-n" id="todoStatTotal">0</div><div class="shop-stat-l">Total</div></div>
    <div class="shop-stat"><div class="shop-stat-n" id="todoStatLeft">0</div><div class="shop-stat-l">Remaining</div></div>
    <div class="shop-stat"><div class="shop-stat-n" id="todoStatDone">0</div><div class="shop-stat-l">Done</div></div>
    <button class="clear-done" onclick="clearTodoDone()">Clear done √ó</button>
  </div>

  <div class="shop-input-row">
    <input type="text" class="shop-input" id="todoInput" placeholder="Add task‚Ä¶ (press Enter)" onkeydown="if(event.key==='Enter')addTodo()">
    <select class="shop-cat-sel" id="todoCat">
      <option value="Kids">üëß Kids</option>
      <option value="Home">üè† Home</option>
      <option value="Sports">‚öΩ Sports</option>
      <option value="School">üéí School</option>
      <option value="Medical">üíä Medical</option>
      <option value="Admin">üìã Admin</option>
      <option value="Other">üì¶ Other</option>
    </select>
    <select class="shop-cat-sel" id="todoWho" style="max-width:110px">
      <option value="Both">üë®‚Äçüë© Both</option>
      <option value="Josh">üë§ Josh</option>
      <option value="Jess">üë§ Jess</option>
    </select>
    <select class="shop-cat-sel" id="todoPri" style="max-width:110px">
      <option value="normal">‚Äî Normal</option>
      <option value="high">üî¥ High</option>
      <option value="low">üîµ Low</option>
    </select>
    <button class="btn btn-blue" onclick="addTodo()">Add</button>
  </div>
  <div id="todoLists"></div>
</div>
</div>

<!-- ADD/EDIT EVENT -->
<div class="ov" id="addOv">
  <div class="modal">
    <div class="mhd"><span class="mtitle" id="addTtl">New Event</span><button class="mclose" onclick="closeOv('addOv')">‚úï</button></div>
    <div class="mbd">
      <div class="fg"><label class="fl">Type</label><div class="tg" id="typeGrid"></div></div>
      <div class="fg"><label class="fl">Title</label><input type="text" class="fi" id="fT" placeholder="e.g. Maddie ‚Äî Vikings Soccer Practice"></div>
      <div class="f2">
        <div class="fg" style="margin:0"><label class="fl">Date</label><input type="date" class="fi" id="fD"></div>
        <div class="fg" style="margin:0"><label class="fl">Time</label><input type="time" class="fi" id="fTm"></div>
      </div>
      <div class="fg" style="margin-top:14px"><label class="fl">Who</label>
        <div class="wr" id="whoRow">
          <button class="wc" data-w="Maddie" onclick="tgWho(this)">üëß Maddie</button>
          <button class="wc" data-w="Max" onclick="tgWho(this)">üë¶ Max</button>
          <button class="wc" data-w="Both kids" onclick="tgWho(this)">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Both</button>
          <button class="wc" data-w="Josh" onclick="tgWho(this)">üë§ Josh</button>
          <button class="wc" data-w="Jess" onclick="tgWho(this)">üë§ Jess</button>
        </div>
      </div>
      <div class="f2">
        <div class="fg" style="margin:0"><label class="fl">Location</label><input type="text" class="fi" id="fL" placeholder="Field, gym, address‚Ä¶"></div>
        <div class="fg" style="margin:0"><label class="fl">Coach / Notes</label><input type="text" class="fi" id="fN" placeholder="Coach, carpool, etc."></div>
      </div>
      <div class="mft">
        <button class="btn btn-del" id="delBtn" style="display:none;margin-right:auto" onclick="delEvt()">Delete</button>
        <button class="btn btn-ghost" onclick="closeOv('addOv')">Cancel</button>
        <button class="btn btn-blue" onclick="saveEvt()">Save event</button>
      </div>
    </div>
  </div>
</div>

<!-- DETAIL -->
<div class="ov" id="detOv">
  <div class="modal">
    <div class="mhd"><span class="mtitle" id="detTtl">Event</span><button class="mclose" onclick="closeOv('detOv')">‚úï</button></div>
    <div class="mbd" id="detBd"></div>
  </div>
</div>

<!-- ADD BIRTHDAY -->
<div class="ov" id="bdayAddOv">
  <div class="modal">
    <div class="mhd"><span class="mtitle" id="bdayAddTtl">Add Birthday</span><button class="mclose" onclick="closeOv('bdayAddOv')">‚úï</button></div>
    <div class="mbd">
      <div class="fg"><label class="fl">Name</label><input type="text" class="fi" id="bName" placeholder="e.g. Grandma Linda"></div>
      <div class="f2">
        <div class="fg" style="margin:0"><label class="fl">Month</label>
          <select class="fi" id="bMonth"><option value="1">January</option><option value="2">February</option><option value="3">March</option><option value="4">April</option><option value="5">May</option><option value="6">June</option><option value="7">July</option><option value="8">August</option><option value="9">September</option><option value="10">October</option><option value="11">November</option><option value="12">December</option></select>
        </div>
        <div class="fg" style="margin:0"><label class="fl">Day</label><input type="number" class="fi" id="bDay" min="1" max="31" placeholder="e.g. 14"></div>
      </div>
      <div class="fg"><label class="fl">Emoji / Avatar</label><input type="text" class="fi" id="bEmoji" placeholder="e.g. üë¥ or leave blank"></div>
      <div class="fg"><label class="fl">Relationship</label><input type="text" class="fi" id="bRel" placeholder="e.g. Grandpa, Friend, Cousin‚Ä¶"></div>
      <div class="mft">
        <button class="btn btn-del" id="bdayDelBtn" style="display:none;margin-right:auto" onclick="delBday()">Delete</button>
        <button class="btn btn-ghost" onclick="closeOv('bdayAddOv')">Cancel</button>
        <button class="btn btn-blue" onclick="saveBday()">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- ADD PARTY -->
<div class="ov" id="partyAddOv">
  <div class="modal">
    <div class="mhd"><span class="mtitle" id="partyAddTtl">Add Kid Party</span><button class="mclose" onclick="closeOv('partyAddOv')">‚úï</button></div>
    <div class="mbd">
      <div class="fg"><label class="fl">Birthday Kid's Name</label><input type="text" class="fi" id="pName" placeholder="e.g. Jake"></div>
      <div class="f2">
        <div class="fg" style="margin:0"><label class="fl">Party Date</label><input type="date" class="fi" id="pDate"></div>
        <div class="fg" style="margin:0"><label class="fl">Time</label><input type="time" class="fi" id="pTime"></div>
      </div>
      <div class="fg"><label class="fl">Location</label><input type="text" class="fi" id="pLoc" placeholder="e.g. Bounce House NYC"></div>
      <div class="fg"><label class="fl">Who's Going</label>
        <div class="wr" id="partyWhoRow">
          <button class="wc" data-w="Maddie" onclick="tgPartyWho(this)">üëß Maddie</button>
          <button class="wc" data-w="Max" onclick="tgPartyWho(this)">üë¶ Max</button>
          <button class="wc" data-w="Both" onclick="tgPartyWho(this)">Both</button>
        </div>
      </div>
      <div class="fg"><label class="fl">Gift Status</label>
        <select class="fi" id="pGift">
          <option value="need">üéÅ Need to buy</option>
          <option value="bought">‚úÖ Bought</option>
          <option value="wrapped">üéÄ Wrapped</option>
        </select>
      </div>
      <div class="fg"><label class="fl">Notes</label><input type="text" class="fi" id="pNotes" placeholder="Dress code, bring swimsuit, etc."></div>
      <div class="mft">
        <button class="btn btn-del" id="partyDelBtn" style="display:none;margin-right:auto" onclick="delParty()">Delete</button>
        <button class="btn btn-ghost" onclick="closeOv('partyAddOv')">Cancel</button>
        <button class="btn btn-blue" onclick="saveParty()">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- SETTINGS -->
<div class="ov" id="setOv">
  <div class="modal">
    <div class="mhd"><span class="mtitle">Settings</span><button class="mclose" onclick="closeOv('setOv')">‚úï</button></div>
    <div class="mbd">
      <div class="sc">
        <div class="sct">üîó Share Link</div>
        <div class="scs">Anyone with this link can view and edit your family calendar.</div>
        <div class="sur"><input class="su" value="familyhub.app/j/hodes2026" readonly><button class="btn btn-blue" style="font-size:12px;padding:6px 12px" onclick="cpLink()">Copy</button></div>
      </div>
      <div class="sc">
        <div class="sct">üë• Connected</div>
        <div class="ur"><div class="ud" style="background:var(--green)"></div>Josh ‚Äî active now</div>
        <div class="ur"><div class="ud" style="background:#a78bfa"></div>Jess ‚Äî last seen 2h ago</div>
      </div>
    </div>
  </div>
</div>

<!-- DAY DETAIL MODAL -->
<div class="ov" id="dayOv">
  <div class="modal" style="width:520px">
    <div class="mhd">
      <span class="mtitle" id="dayModalTitle"></span>
      <div style="display:flex;align-items:center;gap:8px">
        <button class="btn btn-blue" id="dayModalAdd" style="font-size:12px;padding:5px 12px">+ Add Event</button>
        <button class="mclose" onclick="closeOv('dayOv')">‚úï</button>
      </div>
    </div>
    <div class="mbd" id="dayModalBody" style="max-height:65vh;overflow-y:auto;padding-top:14px"></div>
  </div>
</div>

<div class="toast-root" id="toastRoot"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONSTANTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const MO=['January','February','March','April','May','June','July','August','September','October','November','December'];
const DS=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
const DF=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

const TYPES=[
  {k:'soccer',    l:'Soccer',         e:'‚öΩ',c:'#22c55e', bg:'rgba(34,197,94,.15)', tc:'#4ade80'},
  {k:'wcfc',      l:'WCFC Training',  e:'‚öΩ',c:'#16a34a', bg:'rgba(22,163,74,.15)', tc:'#86efac'},
  {k:'basketball',l:'Basketball',     e:'üèÄ',c:'#f97316', bg:'rgba(249,115,22,.15)',tc:'#fb923c'},
  {k:'baseball',  l:'Baseball',       e:'‚öæ',c:'#eab308', bg:'rgba(234,179,8,.15)', tc:'#fbbf24'},
  {k:'enrichment',l:'Enrichment',     e:'üìö',c:'#a855f7', bg:'rgba(168,85,247,.15)',tc:'#c084fc'},
  {k:'birthday',  l:'Birthday Party', e:'üéÇ',c:'#ec4899', bg:'rgba(236,72,153,.15)',tc:'#f472b6'},
  {k:'equip',     l:'Equip',          e:'üß†',c:'#06b6d4', bg:'rgba(6,182,212,.15)', tc:'#22d3ee'},
  {k:'speech',    l:'Speech',         e:'üó£Ô∏è',c:'#3b82f6', bg:'rgba(59,130,246,.15)',tc:'#60a5fa'},
  {k:'travel',    l:'Work Travel',    e:'‚úàÔ∏è',c:'#ef4444', bg:'rgba(239,68,68,.15)',  tc:'#f87171'},
  {k:'dinner',    l:'Work Dinner',    e:'üçΩÔ∏è',c:'#f59e0b', bg:'rgba(245,158,11,.15)',tc:'#fcd34d'},
  {k:'conference',l:'Parent-Teacher', e:'üë©‚Äçüè´',c:'#6b7280',bg:'rgba(107,114,128,.15)',tc:'#9ca3af'},
  {k:'school-break',l:'School Break', e:'üèñÔ∏è',c:'#8b5cf6', bg:'rgba(139,92,246,.12)',tc:'#a78bfa'},
  {k:'knicks',    l:'Knicks',         e:'üèÄ',c:'#006BB6', bg:'rgba(0,107,182,.2)',   tc:'#60a5fa'},
];
const ti=k=>TYPES.find(t=>t.k===k)||{k,l:k,e:'üìÖ',c:'#6b7280',bg:'rgba(107,114,128,.15)',tc:'#9ca3af'};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function load(key,def){try{const s=localStorage.getItem(key);if(s)return JSON.parse(s);}catch(e){}return def;}
function save(key,val){try{localStorage.setItem(key,JSON.stringify(val));}catch(e){}}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EVENT DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function defaultEvts(){
  let id=1,a=[];

  // School breaks
  [['2025-11-26','2025-11-28','Thanksgiving Break'],
   ['2025-12-22','2026-01-02','Winter Break'],
   ['2026-01-19','2026-01-19','MLK Day ‚Äî No School'],
   ['2026-02-16','2026-02-20','Winter Recess'],
   ['2026-04-06','2026-04-10','Spring Break'],
   ['2026-05-25','2026-05-25','Memorial Day'],
   ['2026-06-19','2026-06-19','Last Day of School'],
   ['2026-06-22','2026-09-04','Summer Break'],
  ].forEach(([s,e,t])=>{
    const sd=new Date(s+'T12:00:00'),ed=new Date(e+'T12:00:00');
    for(let d=new Date(sd);d<=ed;d.setDate(d.getDate()+1))
      a.push({id:id++,type:'school-break',title:t,date:d.toISOString().split('T')[0],who:'Kids',allDay:true});
  });

  // Knicks
  [['2026-02-25','7:30 PM','Knicks @ Cavaliers'],
   ['2026-02-28','8:00 PM','Knicks @ Bucks'],
   ['2026-03-01','1:00 PM','Knicks vs Spurs'],
   ['2026-03-04','7:30 PM','Knicks @ Raptors'],
   ['2026-03-05','7:00 PM','Knicks vs Thunder'],
   ['2026-03-08','3:30 PM','Knicks vs Celtics'],
   ['2026-03-11','8:00 PM','Knicks @ Heat'],
   ['2026-03-13','7:30 PM','Knicks vs Wizards'],
   ['2026-03-15','6:00 PM','Knicks @ Nets'],
   ['2026-03-18','7:30 PM','Knicks vs Lakers'],
   ['2026-03-20','8:00 PM','Knicks @ Bulls'],
   ['2026-03-22','7:30 PM','Knicks vs Pacers'],
   ['2026-03-25','7:00 PM','Knicks @ 76ers'],
   ['2026-03-27','7:30 PM','Knicks vs Hawks'],
   ['2026-03-29','6:00 PM','Knicks @ Raptors'],
   ['2026-04-01','7:30 PM','Knicks vs Nets'],
   ['2026-04-03','7:00 PM','Knicks @ Magic'],
   ['2026-04-05','3:30 PM','Knicks vs Heat'],
   ['2026-04-08','7:30 PM','Knicks @ Cavaliers'],
   ['2026-04-10','7:30 PM','Knicks vs Bucks'],
   ['2026-04-12','1:00 PM','Knicks @ Celtics'],
  ].forEach(([d,t,n])=>a.push({id:id++,type:'knicks',title:n,date:d,time:t,who:'Josh'}));

  // Vikings Soccer ‚Äî Maddie & Max, Coach Joe, Tues/Thurs
  const s0=new Date('2026-03-01T12:00:00'),e0=new Date('2026-05-31T12:00:00');
  for(let d=new Date(s0);d<=e0;d.setDate(d.getDate()+1)){
    const dow=d.getDay();
    if(dow===2||dow===4){
      const ds2=d.toISOString().split('T')[0];
      a.push({id:id++,type:'soccer',title:'Maddie ‚Äî Vikings Soccer Practice',date:ds2,time:'4:00 PM',who:'Maddie',location:'Vikings Home Field',notes:'Coach Joe'});
      a.push({id:id++,type:'soccer',title:'Max ‚Äî Vikings Soccer Practice',date:ds2,time:'5:00 PM',who:'Max',location:'Vikings Home Field',notes:'Coach Joe'});
    }
    // WCFC extra training Saturdays
    if(dow===6){
      const ds2=d.toISOString().split('T')[0];
      a.push({id:id++,type:'wcfc',title:'Maddie ‚Äî WCFC Training',date:ds2,time:'9:00 AM',who:'Maddie',location:'WCFC Training Complex',notes:'Club training'});
      a.push({id:id++,type:'wcfc',title:'Max ‚Äî WCFC Training',date:ds2,time:'10:30 AM',who:'Max',location:'WCFC Training Complex',notes:'Club training'});
    }
  }

  // Soccer Games ‚Äî weekends
  [[2026,3,7,'Maddie ‚Äî Vikings Soccer Game vs Falcons','10:00 AM','Maddie'],
   [2026,3,7,'Max ‚Äî Vikings Soccer Game vs Falcons','11:30 AM','Max'],
   [2026,3,14,'Maddie ‚Äî Vikings Soccer Game vs Storm','10:00 AM','Maddie'],
   [2026,3,14,'Max ‚Äî Vikings Soccer Game vs Storm','11:30 AM','Max'],
   [2026,3,21,'Maddie ‚Äî Vikings Soccer Game vs Thunder','9:00 AM','Maddie'],
   [2026,3,21,'Max ‚Äî Vikings Soccer Game vs Thunder','10:30 AM','Max'],
   [2026,4,4,'Maddie ‚Äî Vikings Soccer Game vs Eagles','10:00 AM','Maddie'],
   [2026,4,4,'Max ‚Äî Vikings Soccer Game vs Eagles','11:30 AM','Max'],
   [2026,4,11,'Maddie ‚Äî Vikings Soccer Game','10:00 AM','Maddie'],
   [2026,4,25,'Max ‚Äî Vikings Soccer Game','11:00 AM','Max'],
  ].forEach(([y,m,d,t,tm,w])=>a.push({id:id++,type:'soccer',title:t,date:`${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`,time:tm,who:w,location:'Vikings Home Field',notes:'Coach Joe'}));

  // Maddie Basketball ‚Äî Gametime, Coach Shannon, Mon/Wed
  for(let d=new Date(s0);d<=e0;d.setDate(d.getDate()+1)){
    const dow=d.getDay();
    if(dow===1||dow===3){
      const ds2=d.toISOString().split('T')[0];
      a.push({id:id++,type:'basketball',title:'Maddie ‚Äî Gametime Basketball Practice',date:ds2,time:'6:00 PM',who:'Maddie',notes:'Coach Shannon'});
    }
  }
  // Maddie Gametime games
  [[2026,3,8,'Maddie ‚Äî Gametime Basketball Game','1:00 PM'],
   [2026,3,15,'Maddie ‚Äî Gametime Basketball Game','2:00 PM'],
   [2026,3,22,'Maddie ‚Äî Gametime Basketball Game','11:00 AM'],
   [2026,4,5,'Maddie ‚Äî Gametime Basketball Game','1:00 PM'],
   [2026,4,12,'Maddie ‚Äî Gametime Basketball Game','2:00 PM'],
  ].forEach(([y,m,d,t,tm])=>a.push({id:id++,type:'basketball',title:t,date:`${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`,time:tm,who:'Maddie',notes:'Coach Shannon ‚Äî Gametime'}));

  // Max Rec Basketball ‚Äî Fridays
  for(let d=new Date(s0);d<=e0;d.setDate(d.getDate()+1)){
    if(d.getDay()===5){
      const ds2=d.toISOString().split('T')[0];
      a.push({id:id++,type:'basketball',title:'Max ‚Äî Rec Basketball Practice',date:ds2,time:'5:00 PM',who:'Max',notes:'Rec league'});
    }
  }
  // Max rec games
  [[2026,3,8,'Max ‚Äî Rec Basketball Game','10:00 AM'],
   [2026,3,15,'Max ‚Äî Rec Basketball Game','10:00 AM'],
   [2026,3,22,'Max ‚Äî Rec Basketball Game','11:00 AM'],
   [2026,4,5,'Max ‚Äî Rec Basketball Game','10:00 AM'],
  ].forEach(([y,m,d,t,tm])=>a.push({id:id++,type:'basketball',title:t,date:`${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`,time:tm,who:'Max',notes:'Rec league'}));

  // Max Baseball ‚Äî Coach Josh, Sat practices + games
  [[2026,3,7,'Max ‚Äî Baseball Practice','9:00 AM','Max','Coach Josh (Dad!)'],
   [2026,3,14,'Max ‚Äî Baseball Practice','9:00 AM','Max','Coach Josh (Dad!)'],
   [2026,3,21,'Max ‚Äî Baseball Practice','9:00 AM','Max','Coach Josh (Dad!)'],
   [2026,3,28,'Max ‚Äî Baseball Practice','9:00 AM','Max','Coach Josh (Dad!)'],
   [2026,4,4,'Max ‚Äî Baseball Game vs Mets','11:00 AM','Max','Coach Josh (Dad!)'],
   [2026,4,11,'Max ‚Äî Baseball Game vs Cubs','10:00 AM','Max','Coach Josh (Dad!)'],
   [2026,4,18,'Max ‚Äî Baseball Game vs Yankees','11:00 AM','Max','Coach Josh (Dad!)'],
   [2026,4,25,'Max ‚Äî Baseball Game vs Red Sox','10:00 AM','Max','Coach Josh (Dad!)'],
   [2026,5,2,'Max ‚Äî Baseball Game','11:00 AM','Max','Coach Josh (Dad!)'],
  ].forEach(([y,m,d,t,tm,w,n])=>a.push({id:id++,type:'baseball',title:t,date:`${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`,time:tm,who:w,notes:n}));

  // Speech ‚Äî Maddie
  for(let d=new Date(s0);d<=e0;d.setDate(d.getDate()+1)){
    if(d.getDay()===3){
      const ds2=d.toISOString().split('T')[0];
      a.push({id:id++,type:'speech',title:'Maddie ‚Äî Speech Therapy',date:ds2,time:'3:30 PM',who:'Maddie'});
    }
  }

  // Equip ‚Äî Max
  for(let d=new Date(s0);d<=e0;d.setDate(d.getDate()+1)){
    if(d.getDay()===4){
      const ds2=d.toISOString().split('T')[0];
      a.push({id:id++,type:'equip',title:'Max ‚Äî Equip Appointment',date:ds2,time:'4:30 PM',who:'Max'});
    }
  }

  // Enrichment both kids
  for(let d=new Date(s0);d<=e0;d.setDate(d.getDate()+1)){
    if(d.getDay()===5){
      const ds2=d.toISOString().split('T')[0];
      a.push({id:id++,type:'enrichment',title:'Enrichment Class ‚Äî Both Kids',date:ds2,time:'2:00 PM',who:'Both kids'});
    }
  }

  // Misc
  a.push({id:id++,type:'birthday',title:"Jake's Birthday Party",date:'2026-03-07',time:'2:00 PM',location:'Bounce House NYC',who:'Both kids'});
  a.push({id:id++,type:'birthday',title:"Mia's Birthday Party",date:'2026-04-11',time:'1:00 PM',who:'Maddie'});
  a.push({id:id++,type:'conference',title:"Parent-Teacher ‚Äî Maddie",date:'2026-03-12',time:'5:00 PM',who:'Josh'});
  a.push({id:id++,type:'conference',title:"Parent-Teacher ‚Äî Max",date:'2026-03-12',time:'5:45 PM',who:'Josh'});
  a.push({id:id++,type:'travel',title:'Work Trip ‚Äî Chicago',date:'2026-03-09',time:'Departs 7 AM',who:'Josh'});
  a.push({id:id++,type:'travel',title:'Return from Chicago',date:'2026-03-11',time:'Evening',who:'Josh'});
  a.push({id:id++,type:'dinner',title:'Work Dinner',date:'2026-03-17',time:'7:00 PM',who:'Josh'});
  a.push({id:id++,type:'dinner',title:'Client Dinner',date:'2026-04-07',time:'7:30 PM',who:'Josh'});

  return a;
}

let evts=load('fh4',null)||defaultEvts();
let nid=Math.max(0,...evts.map(e=>e.id))+1;

// Birthday book
let bdays=load('fh_bdays',[
  {id:1,name:'Grandma Linda',month:3,day:14,emoji:'üëµ',rel:'Grandma'},
  {id:2,name:'Grandpa Bob',month:7,day:22,emoji:'üë¥',rel:'Grandpa'},
  {id:3,name:'Uncle Mike',month:5,day:8,emoji:'üë®',rel:'Uncle'},
  {id:4,name:'Aunt Sarah',month:9,day:3,emoji:'üë©',rel:'Aunt'},
]);
let nbid=Math.max(0,...bdays.map(b=>b.id))+1;

// Parties
let parties=load('fh_parties',[
  {id:1,name:'Jake',date:'2026-03-07',time:'2:00 PM',location:'Bounce House NYC',who:'Both',gift:'need',notes:''},
  {id:2,name:'Mia',date:'2026-04-11',time:'1:00 PM',location:'',who:'Maddie',gift:'need',notes:''},
]);
let npid=Math.max(0,...parties.map(p=>p.id))+1;

// Shopping list
let shopItems=load('fh_shop',[
  {id:1,name:'Whole milk',cat:'Groceries',qty:'1 gal',done:false},
  {id:2,name:'Chicken breast',cat:'Groceries',qty:'2 lbs',done:false},
  {id:3,name:'Maddie cleats size 4',cat:'Sports',qty:'1',done:false},
  {id:4,name:'Baseball batting gloves ‚Äî Max',cat:'Sports',qty:'1',done:false},
  {id:5,name:'Sunscreen SPF 50',cat:'Household',qty:'2',done:false},
]);
let nsid=Math.max(0,...shopItems.map(s=>s.id))+1;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CALENDAR STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let cur=new Date(); cur.setDate(1);
let mini=new Date(cur);
let view='month';
let filters=new Set(TYPES.map(t=>t.k));
let eid=null,sType='soccer',sWho=new Set();

function ds(y,m,d){return`${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`}
function today(){return new Date().toISOString().split('T')[0]}
function dEvts(s){return evts.filter(e=>e.date===s&&filters.has(e.type))}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER CALENDAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function render(){rTopLbl();rMini();rCats();rUp();view==='month'?rMonth():rList();}

function rTopLbl(){document.getElementById('mainLbl').textContent=`${MO[cur.getMonth()]} ${cur.getFullYear()}`;}

function rMini(){
  const y=mini.getFullYear(),m=mini.getMonth();
  document.getElementById('miniLbl').textContent=`${MO[m].slice(0,3)} ${y}`;
  const f=new Date(y,m,1).getDay(),dim=new Date(y,m+1,0).getDate(),td=new Date();
  let h=DS.map(d=>`<div class="mc-dow">${d[0]}</div>`).join('');
  for(let i=0;i<f;i++)h+='<div></div>';
  for(let d=1;d<=dim;d++){
    const s=ds(y,m+1,d),isT=d===td.getDate()&&m===td.getMonth()&&y===td.getFullYear(),hasDot=evts.some(e=>e.date===s);
    h+=`<div class="mc-d${isT?' tod':''}${hasDot?' dot':''}" onclick="jumpTo(${y},${m},${d})">${d}</div>`;
  }
  document.getElementById('miniGrid').innerHTML=h;
}

function rCats(){
  const m=cur.getMonth(),y=cur.getFullYear(),counts={};
  evts.forEach(e=>{if(e.date.startsWith(`${y}-${String(m+1).padStart(2,'0')}`))counts[e.type]=(counts[e.type]||0)+1;});
  document.getElementById('catList').innerHTML=TYPES.map(t=>`
    <div class="cat${filters.has(t.k)?'':' off'}" onclick="tgFilter('${t.k}')">
      <div class="cat-dot" style="background:${t.c}"></div>
      <span class="cat-em">${t.e}</span>
      <span class="cat-n">${t.l}</span>
      <span class="cat-c">${counts[t.k]||''}</span>
    </div>`).join('');
}

function rUp(){
  const td=today();
  const up=evts.filter(e=>e.date>=td&&filters.has(e.type)&&e.type!=='school-break')
    .sort((a,b)=>a.date.localeCompare(b.date)||(a.time||'').localeCompare(b.time||'')).slice(0,7);
  document.getElementById('upList').innerHTML=up.map(e=>{
    const t=ti(e.type),d=new Date(e.date+'T12:00:00'),lbl=`${MO[d.getMonth()].slice(0,3)} ${d.getDate()}${e.time?' ¬∑ '+e.time:''}`;
    return`<div class="up-item" onclick="showDet(${e.id})"><div class="up-bar" style="background:${t.c}"></div><div class="up-in"><div class="up-name">${t.e} ${e.title}</div><div class="up-meta">${lbl}</div></div></div>`;
  }).join('')||'<div style="font-size:11px;color:var(--muted);padding:4px 4px">No upcoming events</div>';
}

function rMonth(){
  const y=cur.getFullYear(),m=cur.getMonth(),f=new Date(y,m,1).getDay(),dim=new Date(y,m+1,0).getDate(),prev=new Date(y,m,0).getDate(),td=new Date();
  function cell(d,s,out){
    const es=dEvts(s),isT=!out&&d===td.getDate()&&m===td.getMonth()&&y===td.getFullYear();
    const isBrk=es.some(e=>e.type==='school-break'),be=es.find(e=>e.type==='school-break');
    const nb=es.filter(e=>e.type!=='school-break'),sh=nb.slice(0,3),xtra=nb.length-3;
    return`<div class="cell${out?' out':''}${isT?' tod':''}${isBrk?' brk':''}" onclick="clickDay('${s}')">
      <div class="ct"><div class="dnw"><span class="dn">${d}</span></div></div>
      <div class="ces">
        ${be?`<div class="ev" style="background:${ti('school-break').bg};color:${ti('school-break').tc}" onclick="event.stopPropagation();showDet(${be.id})"><span class="ev-i">${ti('school-break').e}</span><span class="ev-l">${be.title}</span></div>`:''}
        ${sh.map(e=>{const t=ti(e.type);return`<div class="ev" style="background:${t.bg};color:${t.tc}" onclick="event.stopPropagation();showDet(${e.id})"><span class="ev-i">${t.e}</span><span class="ev-l">${e.title}</span></div>`}).join('')}
        ${xtra>0?`<div class="ev-m" onclick="event.stopPropagation();clickDay('${s}')">+${xtra} more</div>`:''}
      </div>
    </div>`;
  }
  let h=`<div class="cg-wrap"><div class="cg"><div class="chr">${DS.map(d=>`<div class="chc">${d}</div>`).join('')}</div><div class="cb">`;
  for(let i=f-1;i>=0;i--)h+=cell(prev-i,ds(y,m,prev-i),true);
  for(let d=1;d<=dim;d++)h+=cell(d,ds(y,m+1,d),false);
  const trail=42-(f+dim);for(let d=1;d<=trail;d++)h+=cell(d,ds(y,m+2,d),true);
  h+=`</div></div></div>`;
  document.getElementById('mainContent').innerHTML=h;
}

function rList(){
  const y=cur.getFullYear(),m=cur.getMonth(),dim=new Date(y,m+1,0).getDate(),td=today();
  let h='<div class="lw">';
  for(let d=1;d<=dim;d++){
    const s=ds(y,m+1,d),es=dEvts(s);if(!es.length)continue;
    const dt=new Date(s+'T12:00:00'),lbl=`${DS[dt.getDay()].toUpperCase()}, ${MO[m].slice(0,3).toUpperCase()} ${d}`,isT=s===td;
    h+=`<div><div class="ld-hd"><span class="ld-lbl${isT?' tl':''}">${isT?'TODAY ‚Äî ':''}${lbl}</span><div class="ld-line"></div></div>`;
    es.sort((a,b)=>(a.time||'99:99').localeCompare(b.time||'99:99')).forEach(e=>{
      const t=ti(e.type);
      h+=`<div class="lc" onclick="showDet(${e.id})"><div class="lc-strip" style="background:${t.c}"></div><div class="lc-ico">${t.e}</div><div class="lc-b"><div class="lc-t">${e.title}</div><div class="lc-s">${e.time||'All day'}${e.location?' ¬∑ '+e.location:''}${e.notes?' ¬∑ '+e.notes:''}</div></div><div>${e.who?`<span class="tag">${e.who}</span>`:''}</div></div>`;
    });
    h+=`</div>`;
  }
  h+='</div>';
  document.getElementById('mainContent').innerHTML=h;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function navigate(d){cur=new Date(cur.getFullYear(),cur.getMonth()+d,1);mini=new Date(cur);render();}
function goToday(){cur=new Date();cur.setDate(1);mini=new Date(cur);render();}
function miniNav(d){mini=new Date(mini.getFullYear(),mini.getMonth()+d,1);rMini();}
function jumpTo(y,m,d){cur=new Date(y,m,1);mini=new Date(cur);render();}
function setView(v){view=v;document.getElementById('vbM').classList.toggle('on',v==='month');document.getElementById('vbL').classList.toggle('on',v==='list');render();}
function tgFilter(k){filters.has(k)?filters.delete(k):filters.add(k);rCats();rUp();view==='month'?rMonth():rList();rMini();}
function clickDay(s){
  const es=evts.filter(e=>e.date===s);
  const d=new Date(s+'T12:00:00');
  const dl=`${DF[d.getDay()]}, ${MO[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
  document.getElementById('dayModalTitle').textContent=dl;
  const body=document.getElementById('dayModalBody');
  if(!es.length){
    body.innerHTML=`<div style="text-align:center;padding:32px 0;color:var(--muted)">
      <div style="font-size:32px;margin-bottom:10px">üì≠</div>
      <div style="font-size:13px">Nothing scheduled</div>
    </div>`;
  } else {
    const sorted=[...es].sort((a,b)=>(a.time||'99:99').localeCompare(b.time||'99:99'));
    body.innerHTML=sorted.map(e=>{
      const t=ti(e.type);
      return`<div class="lc" style="margin-bottom:6px" onclick="closeOv('dayOv');showDet(${e.id})">
        <div class="lc-strip" style="background:${t.c}"></div>
        <div class="lc-ico">${t.e}</div>
        <div class="lc-b">
          <div class="lc-t">${e.title}</div>
          <div class="lc-s">${e.time||'All day'}${e.location?' ¬∑ '+e.location:''}${e.notes?' ¬∑ '+e.notes:''}</div>
        </div>
        ${e.who?`<span class="tag">${e.who}</span>`:''}
      </div>`;
    }).join('');
  }
  document.getElementById('dayModalAdd').onclick=()=>{closeOv('dayOv');openAdd(s);};
  openOv('dayOv');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// OVERLAYS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openOv(id){document.getElementById(id).classList.add('open');}
function closeOv(id){document.getElementById(id).classList.remove('open');}
document.querySelectorAll('.ov').forEach(el=>el.addEventListener('click',function(e){if(e.target===this)closeOv(this.id);}));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADD / EDIT EVENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openAdd(s){
  eid=null;sType='soccer';sWho=new Set();
  document.getElementById('addTtl').textContent='New Event';
  document.getElementById('delBtn').style.display='none';
  document.getElementById('fT').value='';
  document.getElementById('fD').value=s||today();
  document.getElementById('fTm').value='';
  document.getElementById('fL').value='';
  document.getElementById('fN').value='';
  bTypeGrid();uWho();openOv('addOv');
  setTimeout(()=>document.getElementById('fT').focus(),200);
}

function bTypeGrid(){
  document.getElementById('typeGrid').innerHTML=TYPES.map(t=>`
    <button class="tc${sType===t.k?' on':''}" onclick="pType('${t.k}')">
      <span class="tc-i">${t.e}</span><span>${t.l}</span>
    </button>`).join('');
}

function pType(k){sType=k;bTypeGrid();}
function tgWho(b){const w=b.dataset.w;sWho.has(w)?sWho.delete(w):sWho.add(w);uWho();}
function uWho(){document.querySelectorAll('#whoRow .wc').forEach(b=>b.classList.toggle('on',sWho.has(b.dataset.w)));}

function saveEvt(){
  const t=document.getElementById('fT').value.trim();
  if(!t){toast('‚ö†Ô∏è','Enter a title');return;}
  const d=document.getElementById('fD').value;
  if(!d){toast('‚ö†Ô∏è','Pick a date');return;}
  const e={id:eid||nid++,type:sType,title:t,date:d,time:document.getElementById('fTm').value||'',location:document.getElementById('fL').value||'',notes:document.getElementById('fN').value||'',who:[...sWho].join(', ')||''};
  if(eid){const i=evts.findIndex(x=>x.id===eid);if(i>=0)evts[i]=e;}else evts.push(e);
  save('fh4',evts);closeOv('addOv');render();toast('‚úì',eid?'Event updated':'Event added');
}

function editEvt(id){
  const e=evts.find(x=>x.id===id);if(!e)return;
  closeOv('detOv');eid=id;sType=e.type;sWho=new Set(e.who?e.who.split(', ').filter(Boolean):[]);
  document.getElementById('addTtl').textContent='Edit Event';
  document.getElementById('delBtn').style.display='';
  document.getElementById('fT').value=e.title;
  document.getElementById('fD').value=e.date;
  document.getElementById('fTm').value=e.time||'';
  document.getElementById('fL').value=e.location||'';
  document.getElementById('fN').value=e.notes||'';
  bTypeGrid();uWho();openOv('addOv');
}

function delEvt(){
  if(!eid||!confirm('Delete this event?'))return;
  evts=evts.filter(e=>e.id!==eid);save('fh4',evts);closeOv('addOv');render();toast('üóë','Deleted');
}

function showDet(id){
  const e=evts.find(x=>x.id===id);if(!e)return;
  const t=ti(e.type),d=new Date(e.date+'T12:00:00'),dl=`${DF[d.getDay()]}, ${MO[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
  document.getElementById('detTtl').textContent=e.title;
  document.getElementById('detBd').innerHTML=`
    <div class="dbadge" style="background:${t.bg};color:${t.tc}">${t.e} ${t.l}</div>
    <div class="dr"><span class="di">üìÖ</span><span class="dl">Date</span><span class="dv">${dl}</span></div>
    ${e.time?`<div class="dr"><span class="di">üïê</span><span class="dl">Time</span><span class="dv">${e.time}</span></div>`:''}
    ${e.who?`<div class="dr"><span class="di">üë§</span><span class="dl">Who</span><span class="dv">${e.who}</span></div>`:''}
    ${e.location?`<div class="dr"><span class="di">üìç</span><span class="dl">Location</span><span class="dv">${e.location}</span></div>`:''}
    ${e.notes?`<div class="dr"><span class="di">üìù</span><span class="dl">Notes</span><span class="dv">${e.notes}</span></div>`:''}
    <div class="mft"><button class="btn btn-ghost" onclick="closeOv('detOv')" style="flex:1">Close</button><button class="btn btn-blue" onclick="editEvt(${id})" style="flex:1">Edit</button></div>`;
  openOv('detOv');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BIRTHDAY BOOK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let editBdayId=null;

function renderBdays(){
  const today2=new Date();
  const withDays=bdays.map(b=>{
    const next=new Date(today2.getFullYear(),b.month-1,b.day);
    if(next<today2)next.setFullYear(today2.getFullYear()+1);
    const diff=Math.ceil((next-today2)/(1000*60*60*24));
    return{...b,diff,next};
  }).sort((a,b)=>a.diff-b.diff);

  document.getElementById('bdayGrid').innerHTML=withDays.map(b=>`
    <div class="bday-card">
      <div class="bday-avatar">${b.emoji||'üéÇ'}</div>
      <div class="bday-info">
        <div class="bday-name">${b.name}</div>
        <div class="bday-date">${b.rel||''} ¬∑ ${MO[b.month-1]} ${b.day}</div>
        ${b.diff<=30?`<div class="bday-soon">‚ö° In ${b.diff} day${b.diff===1?'':'s'}!</div>`:b.diff<=60?`<div style="font-size:10px;color:var(--muted);margin-top:2px">In ${b.diff} days</div>`:''}
      </div>
      <div class="bday-actions">
        <button class="icon-btn-sm" onclick="editBday(${b.id})" title="Edit">‚úèÔ∏è</button>
        <button class="icon-btn-sm" onclick="removeBday(${b.id})" title="Delete">üóë</button>
      </div>
    </div>`).join('')||'<div style="color:var(--muted);font-size:13px">No birthdays yet ‚Äî add some!</div>';
}

function renderParties(){
  const sorted=[...parties].sort((a,b)=>a.date.localeCompare(b.date));
  document.getElementById('partyList').innerHTML=sorted.map(p=>{
    const d=new Date(p.date+'T12:00:00'),dl=`${MO[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
    const giftMap={need:['gift-need','üéÅ Need to buy'],bought:['gift-bought','‚úÖ Bought'],wrapped:['gift-wrapped','üéÄ Wrapped']};
    const [gc,gl]=giftMap[p.gift]||giftMap.need;
    return`<div class="party-card">
      <div class="party-ico">üéâ</div>
      <div class="party-info">
        <div class="party-name">${p.name}'s Birthday Party</div>
        <div class="party-meta">${dl}${p.time?' ¬∑ '+p.time:''}${p.location?' ¬∑ '+p.location:''}${p.who?' ¬∑ '+p.who:''}</div>
        ${p.notes?`<div class="party-meta" style="margin-top:2px">üìù ${p.notes}</div>`:''}
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
        <button class="gift-badge ${gc}" onclick="cycleGift(${p.id})">${gl}</button>
        <div style="display:flex;gap:4px">
          <button class="icon-btn-sm" onclick="editParty(${p.id})">‚úèÔ∏è</button>
          <button class="icon-btn-sm" onclick="removeParty(${p.id})">üóë</button>
        </div>
      </div>
    </div>`;
  }).join('')||'<div style="color:var(--muted);font-size:13px;padding:8px 0">No upcoming parties ‚Äî add one!</div>';
}

let partyWho=new Set();
function tgPartyWho(b){const w=b.dataset.w;partyWho.has(w)?partyWho.delete(w):partyWho.add(w);document.querySelectorAll('#partyWhoRow .wc').forEach(x=>x.classList.toggle('on',partyWho.has(x.dataset.w)));}

function openBdayAdd(){
  editBdayId=null;
  document.getElementById('bdayAddTtl').textContent='Add Birthday';
  document.getElementById('bdayDelBtn').style.display='none';
  ['bName','bDay','bEmoji','bRel'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('bMonth').value='1';
  openOv('bdayAddOv');
}

function editBday(id){
  const b=bdays.find(x=>x.id===id);if(!b)return;
  editBdayId=id;
  document.getElementById('bdayAddTtl').textContent='Edit Birthday';
  document.getElementById('bdayDelBtn').style.display='';
  document.getElementById('bName').value=b.name;
  document.getElementById('bMonth').value=b.month;
  document.getElementById('bDay').value=b.day;
  document.getElementById('bEmoji').value=b.emoji||'';
  document.getElementById('bRel').value=b.rel||'';
  openOv('bdayAddOv');
}

function saveBday(){
  const name=document.getElementById('bName').value.trim();
  if(!name){toast('‚ö†Ô∏è','Enter a name');return;}
  const day=parseInt(document.getElementById('bDay').value);
  if(!day||day<1||day>31){toast('‚ö†Ô∏è','Enter a valid day');return;}
  const b={id:editBdayId||nbid++,name,month:parseInt(document.getElementById('bMonth').value),day,emoji:document.getElementById('bEmoji').value.trim()||'üéÇ',rel:document.getElementById('bRel').value.trim()};
  if(editBdayId){const i=bdays.findIndex(x=>x.id===editBdayId);if(i>=0)bdays[i]=b;}else bdays.push(b);
  save('fh_bdays',bdays);closeOv('bdayAddOv');renderBdays();toast('üéÇ','Birthday saved');
}

function delBday(){
  if(!editBdayId)return;
  bdays=bdays.filter(x=>x.id!==editBdayId);save('fh_bdays',bdays);closeOv('bdayAddOv');renderBdays();toast('üóë','Removed');
}
function removeBday(id){bdays=bdays.filter(x=>x.id!==id);save('fh_bdays',bdays);renderBdays();toast('üóë','Removed');}

let editPartyId=null;
function openPartyAdd(){
  editPartyId=null;partyWho=new Set();
  document.getElementById('partyAddTtl').textContent='Add Party';
  document.getElementById('partyDelBtn').style.display='none';
  ['pName','pLoc','pNotes'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('pDate').value=today();
  document.getElementById('pTime').value='';
  document.getElementById('pGift').value='need';
  document.querySelectorAll('#partyWhoRow .wc').forEach(b=>b.classList.remove('on'));
  openOv('partyAddOv');
}

function editParty(id){
  const p=parties.find(x=>x.id===id);if(!p)return;
  editPartyId=id;partyWho=new Set(p.who?p.who.split(', '):[]);
  document.getElementById('partyAddTtl').textContent='Edit Party';
  document.getElementById('partyDelBtn').style.display='';
  document.getElementById('pName').value=p.name;
  document.getElementById('pDate').value=p.date;
  document.getElementById('pTime').value=p.time||'';
  document.getElementById('pLoc').value=p.location||'';
  document.getElementById('pGift').value=p.gift||'need';
  document.getElementById('pNotes').value=p.notes||'';
  document.querySelectorAll('#partyWhoRow .wc').forEach(b=>b.classList.toggle('on',partyWho.has(b.dataset.w)));
  openOv('partyAddOv');
}

function saveParty(){
  const name=document.getElementById('pName').value.trim();
  if(!name){toast('‚ö†Ô∏è','Enter the kid\'s name');return;}
  const p={id:editPartyId||npid++,name,date:document.getElementById('pDate').value,time:document.getElementById('pTime').value,location:document.getElementById('pLoc').value,who:[...partyWho].join(', '),gift:document.getElementById('pGift').value,notes:document.getElementById('pNotes').value};
  if(editPartyId){const i=parties.findIndex(x=>x.id===editPartyId);if(i>=0)parties[i]=p;}else parties.push(p);
  save('fh_parties',parties);closeOv('partyAddOv');renderParties();toast('üéâ','Party added');
}

function delParty(){
  if(!editPartyId)return;
  parties=parties.filter(x=>x.id!==editPartyId);save('fh_parties',parties);closeOv('partyAddOv');renderParties();toast('üóë','Removed');
}
function removeParty(id){parties=parties.filter(x=>x.id!==id);save('fh_parties',parties);renderParties();toast('üóë','Removed');}

function cycleGift(id){
  const p=parties.find(x=>x.id===id);if(!p)return;
  const cycle={need:'bought',bought:'wrapped',wrapped:'need'};
  p.gift=cycle[p.gift]||'need';
  save('fh_parties',parties);renderParties();
  toast(p.gift==='bought'?'‚úÖ':'üéÄ',p.gift==='bought'?'Marked as bought':'Marked as wrapped');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SHOPPING LIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderShop(){
  const cats=['Groceries','Household','Kids','Sports','Pharmacy','Other'];
  const total=shopItems.length,done2=shopItems.filter(x=>x.done).length;
  document.getElementById('statTotal').textContent=total;
  document.getElementById('statLeft').textContent=total-done2;
  document.getElementById('statDone').textContent=done2;

  let h='';
  cats.forEach(cat=>{
    const items=shopItems.filter(i=>i.cat===cat);
    if(!items.length)return;
    const catEmoji={Groceries:'ü•¶',Household:'üè†',Kids:'üëß',Sports:'‚öΩ',Pharmacy:'üíä',Other:'üì¶'}[cat]||'üì¶';
    h+=`<div class="shop-section"><div class="shop-cat-hd">${catEmoji} ${cat} <span style="color:var(--muted);font-weight:400;font-size:10px;margin-left:4px">${items.filter(x=>!x.done).length} remaining</span></div>`;
    items.forEach(item=>{
      h+=`<div class="shop-item${item.done?' done':''}" onclick="toggleShop(${item.id})">
        <div class="shop-cb${item.done?' checked':''}"></div>
        <span class="shop-item-name">${item.name}</span>
        ${item.qty?`<span class="shop-item-qty">${item.qty}</span>`:''}
        <button class="shop-del" onclick="event.stopPropagation();delShop(${item.id})">‚úï</button>
      </div>`;
    });
    h+=`</div>`;
  });
  document.getElementById('shopLists').innerHTML=h||'<div style="color:var(--muted);font-size:13px;padding:20px 0;text-align:center">List is empty ‚Äî add something above!</div>';
}

function addShopItem(){
  const name=document.getElementById('shopInput').value.trim();
  if(!name)return;
  const item={id:nsid++,name,cat:document.getElementById('shopCat').value,qty:document.getElementById('shopQty').value.trim(),done:false};
  shopItems.push(item);
  save('fh_shop',shopItems);
  document.getElementById('shopInput').value='';
  document.getElementById('shopQty').value='';
  renderShop();
  toast('üõí',`Added: ${name}`);
}

function toggleShop(id){
  const item=shopItems.find(x=>x.id===id);if(!item)return;
  item.done=!item.done;save('fh_shop',shopItems);renderShop();
}

function delShop(id){shopItems=shopItems.filter(x=>x.id!==id);save('fh_shop',shopItems);renderShop();}
function clearDone(){shopItems=shopItems.filter(x=>!x.done);save('fh_shop',shopItems);renderShop();toast('‚úì','Cleared done items');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGE NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TO-DO LIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let todos=load('fh_todos',[
  {id:1,name:'Register kids for fall soccer season',cat:'Sports',who:'Josh',pri:'high',done:false},
  {id:2,name:'Book Maddie speech therapy for April',cat:'Medical',who:'Jess',pri:'high',done:false},
  {id:3,name:'Order Max baseball cleats',cat:'Sports',who:'Both',pri:'normal',done:false},
  {id:4,name:'Send permission slip ‚Äî Maddie field trip',cat:'School',who:'Jess',pri:'normal',done:false},
  {id:5,name:'Call pediatrician ‚Äî annual checkups',cat:'Medical',who:'Jess',pri:'normal',done:false},
  {id:6,name:'Pick up dry cleaning',cat:'Home',who:'Josh',pri:'low',done:false},
  {id:7,name:'Buy Jake birthday gift',cat:'Kids',who:'Both',pri:'high',done:false},
  {id:8,name:'Schedule HVAC service',cat:'Home',who:'Josh',pri:'low',done:false},
  {id:9,name:'Print Knicks tickets',cat:'Admin',who:'Josh',pri:'normal',done:false},
  {id:10,name:'Renew car registration',cat:'Admin',who:'Josh',pri:'normal',done:false},
]);
let ntid=Math.max(0,...todos.map(t=>t.id))+1;

function renderTodo(){
  const cats=['Kids','Home','Sports','School','Medical','Admin','Other'];
  const total=todos.length,done2=todos.filter(x=>x.done).length;
  document.getElementById('todoStatTotal').textContent=total;
  document.getElementById('todoStatLeft').textContent=total-done2;
  document.getElementById('todoStatDone').textContent=done2;

  const catEmoji={Kids:'üëß',Home:'üè†',Sports:'‚öΩ',School:'üéí',Medical:'üíä',Admin:'üìã',Other:'üì¶'};
  let h='';
  // High priority first, then by cat
  const sorted=[...todos].sort((a,b)=>{
    const po={high:0,normal:1,low:2};
    if(a.done!==b.done)return a.done?1:-1;
    return (po[a.pri]||1)-(po[b.pri]||1);
  });
  cats.forEach(cat=>{
    const items=sorted.filter(i=>i.cat===cat);
    if(!items.length)return;
    const rem=items.filter(x=>!x.done).length;
    h+=`<div class="shop-section">
      <div class="shop-cat-hd">${catEmoji[cat]||'üì¶'} ${cat}
        <span style="color:var(--muted);font-weight:400;font-size:10px;margin-left:4px">${rem} remaining</span>
      </div>`;
    items.forEach(item=>{
      const priClass=item.pri==='high'?'todo-pri-high':item.pri==='low'?'todo-pri-low':'';
      h+=`<div class="shop-item${item.done?' done':''} ${priClass}" style="border-left:3px solid ${item.pri==='high'?'#ef4444':item.pri==='low'?'#3b82f6':'var(--border)'}" onclick="toggleTodo(${item.id})">
        <div class="shop-cb${item.done?' checked':''}"></div>
        <span class="shop-item-name">${item.name}</span>
        <div style="display:flex;align-items:center;gap:5px;flex-shrink:0">
          ${item.pri!=='normal'?`<span class="todo-pri-badge ${item.pri}">${item.pri==='high'?'Urgent':'Low'}</span>`:''}
          <span class="todo-who-badge">${item.who}</span>
          <button class="shop-del" onclick="event.stopPropagation();delTodo(${item.id})">‚úï</button>
        </div>
      </div>`;
    });
    h+=`</div>`;
  });
  document.getElementById('todoLists').innerHTML=h||'<div style="color:var(--muted);font-size:13px;padding:20px 0;text-align:center">All done! üéâ Add a task above.</div>';
}

function addTodo(){
  const name=document.getElementById('todoInput').value.trim();
  if(!name)return;
  const item={id:ntid++,name,cat:document.getElementById('todoCat').value,who:document.getElementById('todoWho').value,pri:document.getElementById('todoPri').value,done:false};
  todos.unshift(item);
  save('fh_todos',todos);
  document.getElementById('todoInput').value='';
  renderTodo();
  toast('‚úÖ',`Added: ${name}`);
}

function toggleTodo(id){
  const item=todos.find(x=>x.id===id);if(!item)return;
  item.done=!item.done;save('fh_todos',todos);renderTodo();
}

function delTodo(id){todos=todos.filter(x=>x.id!==id);save('fh_todos',todos);renderTodo();}
function clearTodoDone(){todos=todos.filter(x=>!x.done);save('fh_todos',todos);renderTodo();toast('‚úì','Cleared completed tasks');}

function showPage(p){
  document.querySelectorAll('.page').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(el=>el.classList.remove('active'));
  document.getElementById('page-'+p).classList.add('active');
  const idx={cal:0,bdays:1,shop:2,todo:3}[p];
  document.querySelectorAll('.nav-tab')[idx].classList.add('active');
  if(p==='bdays'){renderBdays();renderParties();}
  if(p==='shop')renderShop();
  if(p==='todo')renderTodo();
}

// Override modal open buttons for birthday page
document.querySelector('[onclick="openOv(\'bdayAddOv\')"]').onclick=openBdayAdd;
document.querySelector('[onclick="openOv(\'partyAddOv\')"]').onclick=openPartyAdd;

// Settings
function cpLink(){navigator.clipboard.writeText('familyhub.app/j/hodes2026').catch(()=>{});toast('üìé','Link copied!');}

// Toast
function toast(icon,msg){
  const r=document.getElementById('toastRoot'),el=document.createElement('div');
  el.className='toast';el.innerHTML=`<span>${icon}</span><span>${msg}</span>`;
  r.appendChild(el);setTimeout(()=>{el.classList.add('out');setTimeout(()=>el.remove(),200);},2800);
}

// Keyboard
document.addEventListener('keydown',e=>{
  if(e.key==='Escape')document.querySelectorAll('.ov.open').forEach(el=>closeOv(el.id));
  if(e.key==='n'&&!['INPUT','TEXTAREA','SELECT'].includes(document.activeElement.tagName))openAdd();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
render();
</script>
</body>
</html>
